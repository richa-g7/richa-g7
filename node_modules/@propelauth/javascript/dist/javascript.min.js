!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e="undefined"!=typeof globalThis?globalThis:e||self).PropelAuth={})}(this,(function(e){"use strict";class r{constructor(e,r){this.userId=e.userId,this.orgIdToUserOrgInfo=r,this.email=e.email,this.firstName=e.firstName,this.lastName=e.lastName,this.username=e.username,this.createdAt=e.createdAt,this.pictureUrl=e.pictureUrl,this.hasPassword=e.hasPassword,this.hasMfaEnabled=e.hasMfaEnabled,this.canCreateOrgs=e.canCreateOrgs,this.legacyUserId=e.legacyUserId,this.impersonatorUserId=e.impersonatorUserId,this.properties=e.properties}getOrg(e){if(this.orgIdToUserOrgInfo)return this.orgIdToUserOrgInfo[e]}getOrgByName(e){if(!this.orgIdToUserOrgInfo)return;const r=e.toLowerCase().replace(/ /g,"-");for(const e in this.orgIdToUserOrgInfo){const t=this.orgIdToUserOrgInfo[e];if((null==t?void 0:t.urlSafeOrgName)===r)return t}}getUserProperty(e){if(this.properties)return this.properties[e]}getOrgs(){return this.orgIdToUserOrgInfo?Object.values(this.orgIdToUserOrgInfo):[]}isImpersonating(){return!!this.impersonatorUserId}isRole(e,r){const t=this.getOrg(e);return!!t&&t.isRole(r)}isAtLeastRole(e,r){const t=this.getOrg(e);return!!t&&t.isAtLeastRole(r)}hasPermission(e,r){const t=this.getOrg(e);return!!t&&t.hasPermission(r)}hasAllPermissions(e,r){const t=this.getOrg(e);return!!t&&t.hasAllPermissions(r)}static fromJSON(e){const s=JSON.parse(e),o={};for(const e in s.orgIdToUserOrgInfo)o[e]=t.fromJSON(JSON.stringify(s.orgIdToUserOrgInfo[e]));try{return new r({userId:s.userId,email:s.email,createdAt:s.createdAt,firstName:s.firstName,lastName:s.lastName,username:s.username,legacyUserId:s.legacyUserId,impersonatorUserId:s.impersonatorUserId,properties:s.properties,pictureUrl:s.pictureUrl,hasPassword:s.hasPassword,hasMfaEnabled:s.hasMfaEnabled,canCreateOrgs:s.canCreateOrgs},o)}catch(e){throw console.error("Unable to parse User. Make sure the JSON string is a stringified `UserClass` type.",e),e}}}class t{constructor(e,r,t,s,o,n,i){this.orgId=e,this.orgName=r,this.orgMetadata=t,this.urlSafeOrgName=s,this.userAssignedRole=o,this.userInheritedRolesPlusCurrentRole=n,this.userPermissions=i}isRole(e){return this.userAssignedRole===e}isAtLeastRole(e){return this.userInheritedRolesPlusCurrentRole.includes(e)}hasPermission(e){return this.userPermissions.includes(e)}hasAllPermissions(e){return e.every((e=>this.hasPermission(e)))}static fromJSON(e){const r=JSON.parse(e);try{return new t(r.orgId,r.orgName,r.orgMetadata,r.urlSafeOrgName,r.userAssignedRole,r.userInheritedRolesPlusCurrentRole,r.userPermissions)}catch(e){throw console.error("Unable to parse UserOrgInfo. Make sure the JSON string is a stringified `UserOrgInfo` type.",e),e}}}function s(e){return fetch(`${e}/api/v1/refresh_token`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>401===e.status?null:0===e.status?(o(),Promise.reject({status:503,message:"Unable to process authentication response"})):e.ok?function(e){return e.text().then((e=>{try{return function(e){e.orgIdToOrgMemberInfo&&(e.orgHelper=(s=e.orgIdToOrgMemberInfo,{getOrg:e=>s.hasOwnProperty(e)?s[e]:void 0,getOrgIds:()=>Object.keys(s),getOrgs:()=>Object.values(s),getOrgByName(e){for(const r of Object.values(s))if(r.orgName===e||r.urlSafeOrgName===e)return r}}),e.accessHelper=function(e){function r(r,t){const s=e[r];return void 0!==s&&s.userAssignedRole===t}function t(r,t){const s=e[r];return void 0!==s&&s.userInheritedRolesPlusCurrentRole.includes(t)}function s(r,t){const s=e[r];return void 0!==s&&s.userPermissions.includes(t)}function o(r,t){const s=e[r];return void 0!==s&&t.every((e=>s.userPermissions.includes(e)))}return{isRole:r,isAtLeastRole:t,hasPermission:s,hasAllPermissions:o,getAccessHelperWithOrgId:function(e){return{isRole:t=>r(e,t),isAtLeastRole:r=>t(e,r),hasPermission:r=>s(e,r),hasAllPermissions:r=>o(e,r)}}}}(e.orgIdToOrgMemberInfo));var s;return e.userClass=new r({userId:e.user.userId,email:e.user.email,createdAt:e.user.createdAt,firstName:e.user.firstName,lastName:e.user.lastName,username:e.user.username,properties:e.user.properties,pictureUrl:e.user.pictureUrl,hasPassword:e.user.hasPassword,hasMfaEnabled:e.user.mfaEnabled,canCreateOrgs:e.user.canCreateOrgs,legacyUserId:e.user.legacyUserId,impersonatorUserId:e.impersonatorUserId},function(e){if(void 0===e)return;const r={};for(const s of Object.values(e))r[s.orgId]=new t(s.orgId,s.orgName,s.orgMetadata,s.urlSafeOrgName,s.userAssignedRole,s.userInheritedRolesPlusCurrentRole,s.userPermissions);return r}(e.orgIdToOrgMemberInfo)),Promise.resolve(e)}((s=e,JSON.parse(s,(function(e,r){if("org_id"===e)this.orgId=r;else if("org_name"===e)this.orgName=r;else if("org_metadata"===e)this.orgMetadata=r;else if("url_safe_org_name"===e)this.urlSafeOrgName=r;else if("user_role"===e)this.userAssignedRole=r;else if("inherited_user_roles_plus_current_role"===e)this.userInheritedRolesPlusCurrentRole=r;else if("user_permissions"===e)this.userPermissions=r;else if("access_token"===e)this.accessToken=r;else if("expires_at_seconds"===e)this.expiresAtSeconds=r;else if("org_id_to_org_member_info"===e)this.orgIdToOrgMemberInfo=r;else if("user_id"===e)this.userId=r;else if("email_confirmed"===e)this.emailConfirmed=r;else if("first_name"===e)this.firstName=r;else if("last_name"===e)this.lastName=r;else if("picture_url"===e)this.pictureUrl=r;else if("mfa_enabled"===e)this.mfaEnabled=r;else if("has_password"===e)this.hasPassword=r;else if("can_create_orgs"===e)this.canCreateOrgs=r;else if("created_at"===e)this.createdAt=r;else if("last_active_at"===e)this.lastActiveAt=r;else if("legacy_user_id"===e)this.legacyUserId=r;else{if("impersonator_user"!==e)return r;this.impersonatorUserId=r}}))))}catch(e){return console.error("Unable to process authentication response",e),Promise.reject({status:500,message:"Unable to process authentication response"})}var s}),(e=>(console.error("Unable to process authentication response",e),Promise.reject({status:500,message:"Unable to process authentication response"}))))}(e):Promise.reject({status:e.status,message:e.statusText})))}function o(){console.error("Request to PropelAuth failed due to a CORS error. There are a few likely causes: \n 1. In the Frontend Integration section of your dashboard, make sure your requests are coming either the specified Application URL or localhost with a matching port.\n 2. Make sure your server is hosted on HTTPS in production.")}function n(){return Date.now()/1e3}function i(){return"undefined"!=typeof localStorage}function a(e){if(!i())return null;const r=localStorage.getItem(e);if(!r)return null;const t=parseInt(r,10);return Number.isNaN(t)?null:t}const c="__PROPEL_AUTH_LOGGED_IN_AT",u="__PROPEL_AUTH_LOGGED_OUT_AT",l=e=>(window?window.btoa:btoa)(e);const d="active_org_id";
/*! js-cookie v3.0.5 | MIT */function g(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var s in t)e[s]=t[s]}return e}var h=function e(r,t){function s(e,s,o){if("undefined"!=typeof document){"number"==typeof(o=g({},t,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var n="";for(var i in o)o[i]&&(n+="; "+i,!0!==o[i]&&(n+="="+o[i].split(";")[0]));return document.cookie=e+"="+r.write(s,e)+n}}return Object.create({set:s,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],s={},o=0;o<t.length;o++){var n=t[o].split("="),i=n.slice(1).join("=");try{var a=decodeURIComponent(n[0]);if(s[a]=r.read(i,a),e===a)break}catch(e){}}return e?s[e]:s}},remove:function(e,r){s(e,"",g({},r,{expires:-1}))},withAttributes:function(r){return e(this.converter,g({},this.attributes,r))},withConverter:function(r){return e(g({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(r)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});e.ACTIVE_ORG_ID_COOKIE_NAME=d,e.OrgMemberInfoClass=t,e.UserClass=r,e.createClient=function(e){!function(e){try{const r=new URL(e.authUrl);e.authUrl=r.origin}catch(e){throw console.error("Invalid authUrl",e),new Error("Unable to initialize auth client")}void 0===e.enableBackgroundTokenRefresh&&(e.enableBackgroundTokenRefresh=!0)}(e);const r={initialLoadFinished:!1,authenticationInfo:null,observers:[],accessTokenObservers:[],lastLoggedInAtMessage:a(c),lastLoggedOutAtMessage:a(u),authUrl:e.authUrl,refreshInterval:null,lastRefresh:null};function t(e){for(let t=0;t<r.observers.length;t++){const s=r.observers[t];s&&s(e)}}function d(e){var s;const o=null===(s=r.authenticationInfo)||void 0===s?void 0:s.accessToken;r.authenticationInfo=e;const a=null==e?void 0:e.accessToken;!function(e,t){return!e&&(t||!r.initialLoadFinished)}(a,o)?function(e,r){return!r&&e}(a,o)&&(t(!0),function(){const e=n();r.lastLoggedInAtMessage=e,i()&&localStorage.setItem(c,String(e))}()):(t(!1),function(){const e=n();r.lastLoggedOutAtMessage=e,i()&&localStorage.setItem(u,String(e))}()),o!==a&&function(e){for(let t=0;t<r.accessTokenObservers.length;t++){const s=r.accessTokenObservers[t];s&&s(e)}}(a),r.lastRefresh=n(),r.initialLoadFinished=!0}async function g(e){try{const e=await s(r.authUrl);return d(e),e}catch(t){if(e)return r.authenticationInfo;throw d(null),t}}const h=e=>{let t=new URLSearchParams,s=`${r.authUrl}/signup`;if(e){const{postSignupRedirectUrl:r,userSignupQueryParameters:s}=e;r&&t.set("rt",l(r)),s&&Object.entries(s).forEach((([e,r])=>{t.set(e,r)}))}return t.toString()&&(s+=`?${t.toString()}`),s},f=e=>{let t=new URLSearchParams,s=`${r.authUrl}/login`;if(e){const{postLoginRedirectUrl:r,userSignupQueryParameters:s}=e;r&&t.set("rt",l(r)),s&&Object.entries(s).forEach((([e,r])=>{t.set(e,r)}))}return t.toString()&&(s+=`?${t.toString()}`),s},m=e=>{let t=new URLSearchParams,s=`${r.authUrl}/account`;if(e){const{redirectBackToUrl:r}=e;r&&t.set("rt",l(r))}return t.toString()&&(s+=`?${t.toString()}`),s},p=(e,t)=>{let s=new URLSearchParams,o=`${r.authUrl}/org`;return e&&s.set("id",e),t&&t.redirectBackToUrl&&s.set("rt",l(t.redirectBackToUrl)),s.toString()&&(o+=`?${s.toString()}`),o},I=e=>{let t=new URLSearchParams,s=`${r.authUrl}/create_org`;if(e){const{redirectBackToUrl:r}=e;r&&t.set("rt",l(r))}return t.toString()&&(s+=`?${t.toString()}`),s},O=(e,t)=>{let s=new URLSearchParams;return t&&t.redirectBackToUrl&&s.set("rt",l(t.redirectBackToUrl)),s.set("id",e),`${r.authUrl}/saml?${s.toString()}`},U={addLoggedInChangeObserver(e){r.observers.includes(e)?console.error("Observer has been attached already."):e?r.observers.push(e):console.error("Cannot add a null observer")},removeLoggedInChangeObserver(e){const t=r.observers.indexOf(e);-1===t?console.error("Cannot find observer to remove"):r.observers.splice(t,1)},addAccessTokenChangeObserver(e){r.accessTokenObservers.includes(e)?console.error("Observer has been attached already."):e?r.accessTokenObservers.push(e):console.error("Cannot add a null observer")},removeAccessTokenChangeObserver(e){const t=r.accessTokenObservers.indexOf(e);-1===t?console.error("Cannot find observer to remove"):r.accessTokenObservers.splice(t,1)},async getAuthenticationInfoOrNull(e){const t=n();if(e)return await g(!1);if(r.authenticationInfo){if(t+600>r.authenticationInfo.expiresAtSeconds){const e=t<r.authenticationInfo.expiresAtSeconds;return await g(e)}return r.authenticationInfo}return await g(!1)},getSignupPageUrl:e=>h(e),getLoginPageUrl:e=>f(e),getAccountPageUrl:e=>m(e),getOrgPageUrl:(e,r)=>p(e,r),getCreateOrgPageUrl:e=>I(e),getSetupSAMLPageUrl:(e,r)=>O(e,r),redirectToSignupPage(e){window.location.href=h(e)},redirectToLoginPage(e){window.location.href=f(e)},redirectToAccountPage(e){window.location.href=m(e)},redirectToOrgPage(e,r){window.location.href=p(e,r)},redirectToCreateOrgPage(e){window.location.href=I(e)},redirectToSetupSAMLPage(e,r){window.location.href=O(e,r)},async logout(e){const t=await(s=r.authUrl,fetch(`${s}/api/v1/logout`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>0===e.status?(o(),Promise.reject({status:503,message:"Unable to process authentication response"})):e.ok?e.json():(console.error("Logout error",e.status,e.statusText),Promise.reject({status:e.status,message:e.statusText})))));var s;d(null),e&&(window.location.href=t.redirect_to)},destroy(){r.observers=[],r.accessTokenObservers=[],window.removeEventListener("storage",v),r.refreshInterval&&clearInterval(r.refreshInterval)}},v=async function(){if(!i())return;const e=a(u),t=a(c);e&&(!r.lastLoggedOutAtMessage||e>r.lastLoggedOutAtMessage)&&(r.lastLoggedOutAtMessage=e,r.authenticationInfo&&await g(!0)),t&&(!r.lastLoggedInAtMessage||t>r.lastLoggedInAtMessage)&&(r.lastLoggedInAtMessage=t,r.authenticationInfo||await g(!0))},b=async function(){r.lastRefresh&&n()>r.lastRefresh+60?await g(!0):await U.getAuthenticationInfoOrNull()};return"undefined"!=typeof window&&(window.addEventListener("storage",v),window.addEventListener("online",b),window.addEventListener("focus",b),e.enableBackgroundTokenRefresh&&(U.getAuthenticationInfoOrNull(),r.refreshInterval=window.setInterval(U.getAuthenticationInfoOrNull,6e4))),U},e.getActiveOrgId=()=>h.get(d),e.setActiveOrgId=e=>{h.set(d,e,{sameSite:"lax",secure:!0})}}));
//# sourceMappingURL=javascript.min.js.map
